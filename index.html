<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memo</title>
  <style>
    :root {
      --primary: #4a6741;
      --primary-light: #6b8f60;
      --accent: #e8a44a;
      --note-accent: #5b7fb5;
      --bg: #f5f3ef;
      --card: #ffffff;
      --text: #2c2c2c;
      --text-light: #7a7a7a;
      --border: #e5e1db;
      --done: #b8c4b5;
      --shadow: 0 1px 12px rgba(0,0,0,0.05);
      --radius: 10px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.7;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: var(--card);
      border-bottom: 1px solid var(--border);
      padding: 1.25rem 1.5rem;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 1px 6px rgba(0,0,0,0.03);
    }
    .header-inner {
      max-width: 640px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header h1 { font-size: 1.3rem; font-weight: 700; color: var(--primary); }
    .header-actions { display: flex; gap: 0.5rem; }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.15s;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-light); }
    .btn-ghost { background: transparent; color: var(--text-light); border: 1px solid var(--border); }
    .btn-ghost:hover { background: var(--bg); color: var(--text); }

    /* Main */
    main {
      max-width: 640px;
      margin: 0 auto;
      padding: 1.5rem 1rem 6rem;
    }

    /* Status bar */
    .status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.25rem;
      font-size: 0.82rem;
      color: var(--text-light);
    }
    .status-dot {
      width: 8px; height: 8px; border-radius: 50%;
      display: inline-block; margin-right: 0.4rem;
    }
    .status-dot.ok { background: #5cb85c; }
    .status-dot.err { background: #d9534f; }
    .status-dot.loading { background: var(--accent); animation: pulse 1s infinite; }
    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }

    /* Section titles */
    .section-title {
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--primary);
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .section-title.notes-title {
      border-bottom-color: var(--note-accent);
      color: var(--note-accent);
      margin-top: 2rem;
    }
    .section-count {
      font-weight: 400;
      font-size: 0.78rem;
      color: var(--text-light);
    }

    /* Todo list */
    .todo-list { list-style: none; }
    .todo-item {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.85rem 1rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      box-shadow: var(--shadow);
      transition: all 0.15s;
    }
    .todo-item:hover { border-color: #ccc; }
    .todo-item.done { opacity: 0.5; }
    .todo-item.done .todo-text { text-decoration: line-through; color: var(--done); }

    .checkbox {
      width: 22px; height: 22px;
      border: 2px solid var(--border);
      border-radius: 6px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }
    .todo-item.done .checkbox {
      background: var(--primary);
      border-color: var(--primary);
    }
    .todo-item.done .checkbox::after {
      content: '';
      width: 6px; height: 10px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
      margin-bottom: 2px;
    }
    .todo-text { font-size: 0.93rem; font-weight: 500; word-break: break-word; }

    /* Notes list */
    .notes-list { list-style: none; }
    .note-item {
      background: var(--card);
      border: 1px solid var(--border);
      border-left: 3px solid var(--note-accent);
      border-radius: var(--radius);
      padding: 1rem 1.15rem;
      margin-bottom: 0.6rem;
      box-shadow: var(--shadow);
      transition: all 0.15s;
    }
    .note-item:hover { border-color: #ccc; border-left-color: var(--note-accent); }
    .note-text {
      font-size: 0.93rem;
      font-weight: 500;
      word-break: break-word;
      white-space: pre-wrap;
    }
    .note-date {
      font-size: 0.73rem;
      color: var(--text-light);
      margin-top: 0.35rem;
    }

    /* Empty state */
    .empty-notes {
      text-align: center;
      padding: 1.5rem;
      color: var(--text-light);
      font-size: 0.88rem;
      background: var(--card);
      border: 1px dashed var(--border);
      border-radius: var(--radius);
    }

    /* Loading */
    .loading-spinner {
      text-align: center;
      padding: 3rem;
      color: var(--text-light);
      font-size: 0.9rem;
    }

    /* How-to section */
    .howto {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      margin-top: 2rem;
      box-shadow: var(--shadow);
    }
    .howto summary {
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      color: var(--primary);
    }
    .howto-content {
      margin-top: 0.75rem;
      font-size: 0.85rem;
      color: var(--text-light);
      line-height: 1.8;
    }
    .howto-content code {
      background: #f0ede8;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      font-size: 0.82rem;
    }
    .howto-content pre {
      background: #2c2c2c;
      color: #e8e8e8;
      padding: 1rem;
      border-radius: 8px;
      margin: 0.75rem 0;
      overflow-x: auto;
      font-size: 0.82rem;
      line-height: 1.6;
    }

    /* Error banner */
    .error-banner {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      font-size: 0.85rem;
      color: #991b1b;
      display: none;
    }

    footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.75rem;
      color: var(--text-light);
    }

    @media (max-width: 480px) {
      .header { padding: 1rem; }
      .header h1 { font-size: 1.15rem; }
      .btn { padding: 0.45rem 0.8rem; font-size: 0.82rem; }
      main { padding: 1rem 0.75rem 5rem; }
    }
  </style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <h1>Memo</h1>
    <div class="header-actions">
      <a id="editBtn" class="btn btn-primary" target="_blank" rel="noopener">Edit on GitHub</a>
    </div>
  </div>
</header>

<main>
  <div class="status">
    <span><span id="statusDot" class="status-dot loading"></span><span id="statusText">Loading...</span></span>
    <span id="countText"></span>
  </div>

  <div id="errorBanner" class="error-banner"></div>
  <div id="content"><div class="loading-spinner">Loading...</div></div>

  <details class="howto">
    <summary>How to use</summary>
    <div class="howto-content">
      <p><strong>Edit on GitHub</strong> ボタンから <code>memos.json</code> を直接編集できます。</p>
      <p><strong>TODO を追加:</strong></p>
      <pre>{ "text": "やること", "done": false }</pre>
      <p><strong>メモを追加:</strong></p>
      <pre>{ "text": "メモ内容", "date": "2026-02-18" }</pre>
      <p><strong>チェックを付ける:</strong> <code>"done": false</code> を <code>"done": true</code> に変更して Commit。</p>
    </div>
  </details>
</main>

<footer>Powered by GitHub Pages + GitHub API</footer>

<script>
(function() {
  const OWNER = 'nekonekosurf';
  const REPO = 'memo-app';
  const FILE = 'memos.json';
  const BRANCH = 'master';

  const API_URL = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE}?ref=${BRANCH}`;
  const EDIT_URL = `https://github.com/${OWNER}/${REPO}/edit/${BRANCH}/${FILE}`;
  const RAW_URL = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${FILE}`;

  document.getElementById('editBtn').href = EDIT_URL;

  const contentEl = document.getElementById('content');
  const statusDot = document.getElementById('statusDot');
  const statusText = document.getElementById('statusText');
  const countText = document.getElementById('countText');
  const errorBanner = document.getElementById('errorBanner');

  function setStatus(type, text) {
    statusDot.className = 'status-dot ' + type;
    statusText.textContent = text;
  }

  function showError(msg) {
    errorBanner.textContent = msg;
    errorBanner.style.display = 'block';
  }

  function renderData(data) {
    var todos = data.todos || [];
    var notes = data.notes || [];

    var doneCount = todos.filter(function(t) { return t.done; }).length;
    countText.textContent = 'TODO: ' + doneCount + '/' + todos.length + ' done';

    var html = '';

    // TODO section
    html += '<div class="section-title">TODO <span class="section-count">' + doneCount + ' / ' + todos.length + '</span></div>';
    html += '<ul class="todo-list">';
    todos.forEach(function(todo) {
      var cls = todo.done ? 'todo-item done' : 'todo-item';
      html += '<li class="' + cls + '">';
      html += '<div class="checkbox"></div>';
      html += '<span class="todo-text">' + escapeHtml(todo.text) + '</span>';
      html += '</li>';
    });
    html += '</ul>';

    // Notes section
    html += '<div class="section-title notes-title">NOTES <span class="section-count">' + notes.length + ' items</span></div>';
    if (notes.length === 0) {
      html += '<div class="empty-notes">No notes yet. Edit on GitHub to add.</div>';
    } else {
      html += '<ul class="notes-list">';
      notes.forEach(function(note) {
        html += '<li class="note-item">';
        html += '<div class="note-text">' + escapeHtml(note.text) + '</div>';
        if (note.date) {
          html += '<div class="note-date">' + escapeHtml(note.date) + '</div>';
        }
        html += '</li>';
      });
      html += '</ul>';
    }

    contentEl.innerHTML = html;
  }

  function escapeHtml(str) {
    var d = document.createElement('div');
    d.textContent = str;
    return d.innerHTML;
  }

  async function loadData() {
    setStatus('loading', 'Loading...');

    try {
      var res = await fetch(API_URL, {
        headers: { 'Accept': 'application/vnd.github.v3+json' }
      });

      if (res.ok) {
        var apiData = await res.json();
        var decoded = atob(apiData.content);
        var data = JSON.parse(new TextDecoder().decode(
          Uint8Array.from(decoded, function(c) { return c.charCodeAt(0); })
        ));
        renderData(data);
        setStatus('ok', 'Synced from GitHub');
        return;
      }

      var rawRes = await fetch(RAW_URL + '?t=' + Date.now());
      if (rawRes.ok) {
        var data = await rawRes.json();
        renderData(data);
        setStatus('ok', 'Loaded (cached)');
        return;
      }

      throw new Error('Could not fetch data');
    } catch (e) {
      try {
        var localRes = await fetch(FILE + '?t=' + Date.now());
        if (localRes.ok) {
          var data = await localRes.json();
          renderData(data);
          setStatus('ok', 'Loaded (local)');
          return;
        }
      } catch (_) {}

      setStatus('err', 'Error');
      showError('Failed to load data. Check your connection or try refreshing.');
      contentEl.innerHTML = '<div class="empty-notes">Could not load data.</div>';
    }
  }

  loadData();
})();
</script>

</body>
</html>
